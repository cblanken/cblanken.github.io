<!DOCTYPE html>
<html lang="en">



    


<head>
    
    
    
    
    

    <title>cblanken.dev</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://www.cblanken.dev/style.css?h=3182f546a1b9a6e33d32">
    <link rel="stylesheet" href="https://www.cblanken.dev/color/orange-auto.css?h=e80c890ed79117afae1d">

    <meta name="description" content="Walkthrough for the Leviathan cyber wargame.">

    <meta property="og:description" content="Walkthrough for the Leviathan cyber wargame.">
    <meta property="og:title" content="cblanken.dev">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.cblanken.dev/articles/overthewireleviathan/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="Walkthrough for the Leviathan cyber wargame.">
    <meta name="twitter:title" content="cblanken.dev">
    <meta property="twitter:domain" content="www.cblanken.dev">
    <meta property="twitter:url" content="https://www.cblanken.dev/articles/overthewireleviathan/">

        <!-- Umami Analytics -->
        <script defer src="https://cloud.umami.is/script.js" data-website-id="e421f4ef-172d-42f3-bc26-4bcedb0359b0"></script>
    
        <link rel="shortcut icon" type="image/svg" href="/favicon.svg">
    
    </head>

<body>
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://www.cblanken.dev" style="text-decoration: none;">
                    <div class="logo">
                      
                            cblanken.dev
                        
                    </div>
                </a>
            </div>
            <div id="change-lang" class="logo">
                <select>
                    <button>
                            <svg fill="currentColor" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="796 796 200 200" enable-background="new 796 796 200 200" xml:space="preserve"> <g> <path d="M973.166,818.5H818.833c-12.591,0-22.833,10.243-22.833,22.833v109.333c0,12.59,10.243,22.833,22.833,22.833h154.333 c12.59,0,22.834-10.243,22.834-22.833V841.333C996,828.743,985.756,818.5,973.166,818.5z M896,961.5h-77.167 c-5.973,0-10.833-4.859-10.833-10.833V841.333c0-5.974,4.86-10.833,10.833-10.833H896V961.5z M978.58,872.129 c-0.547,9.145-5.668,27.261-20.869,39.845c4.615,1.022,9.629,1.573,14.92,1.573v12c-10.551,0-20.238-1.919-28.469-5.325 c-7.689,3.301-16.969,5.325-28.125,5.325v-12c5.132,0,9.924-0.501,14.366-1.498c-8.412-7.016-13.382-16.311-13.382-26.78h11.999 c0,8.857,5.66,16.517,14.884,21.623c4.641-2.66,8.702-6.112,12.164-10.351c5.628-6.886,8.502-14.521,9.754-20.042h-49.785v-12 h22.297v-11.986h12V864.5h21.055c1.986,0,3.902,0.831,5.258,2.28C977.986,868.199,978.697,870.155,978.58,872.129z"/> <g> <g> <path d="M839.035,914.262l-4.45,11.258h-15.971l26.355-61.09h15.971l25.746,61.09h-16.583l-4.363-11.258H839.035z M852.475,879.876l-8.902,22.604h17.629L852.475,879.876z"/> </g> </g> </g> </svg>
                    </button>
                    
                     
                        
                            
                        
                        <option value="">EN</option>
                     
                        
                            
                        
                        <option value="de">DE</option>
                    
                    <script>
                        let a;
                        document.querySelector("#change-lang").addEventListener("change", e => {
                            window.location = `/${e.target.value}`;
                        });
                    </script>
                </select>
            </div>
        </div>

        
        
    
    
        
            
                
                    
                        
                    
                

                

                
            
                
                    
                        
                    
                

                

                
                    
                
            
                
                    
                        
                    
                

                

                
            
                
                    
                        
                    
                

                

                
            
                
                    
                        
                    
                

                

                
            
                
                    
                        
                    
                

                

                
            
                
                    
                        
                    
                

                

                
            
                

                

                
            

            

            
    
        
        <nav class="menu">
            <ul class="menu__inner">
            
                <li >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;about">About</a>
                        
                    
                </li>
            
                <li  class="active" >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles">Articles</a>
                        
                    
                </li>
            
                <li >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;journal">Journal</a>
                        
                    
                </li>
            
                <li >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;projects">Projects</a>
                        
                    
                </li>
            
                <li >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;archive">Archive</a>
                        
                    
                </li>
            
                <li >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;tags">Tags</a>
                        
                    
                </li>
            
                <li >
                    
                        
                            
                        

                        
                            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;feeds">RSS</a>
                        
                    
                </li>
            
                <li >
                    
                        
                            <a class="external-link" href="https://github.com/cblanken" target="_blank" rel="noopener noreferrer">GitHub</a>
                        
                    
                </li>
            
            </ul>
        </nav>
    

    

        

    </header>
    

     

<div class="post">
  
  <div class="toc-container">
    <div class="toc">
      <div class="toc-header">Table of Contents</div>
      <div class="toc-title">
        <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#title">OverTheWire - Leviathan</a>
      </div>
      <div class="toc-items-container">
        <ol class="toc-items">
          
          <li class="toc-item">
            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#introduction">Introduction</a>
            <ol>
              
            </ol>
          </li>
          
          <li class="toc-item">
            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#walkthrough">Walkthrough</a>
            <ol>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-0">Level 0</a>
                <ol>
                  
                  <li class="toc-item">
                    <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#solution">Solution</a>
                  </li>
                  
                </ol>
              </li>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-1">Level 1</a>
                <ol>
                  
                  <li class="toc-item">
                    <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#solution-1">Solution</a>
                  </li>
                  
                </ol>
              </li>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-2">Level 2</a>
                <ol>
                  
                  <li class="toc-item">
                    <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#the-setuid-bit">The setuid bit</a>
                  </li>
                  
                  <li class="toc-item">
                    <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#solution-2">Solution</a>
                  </li>
                  
                </ol>
              </li>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-3">Level 3</a>
                <ol>
                  
                </ol>
              </li>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-4">Level 4</a>
                <ol>
                  
                  <li class="toc-item">
                    <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#solution-3">Solution</a>
                  </li>
                  
                </ol>
              </li>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-5">Level 5</a>
                <ol>
                  
                  <li class="toc-item">
                    <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#solution-4">Solution</a>
                  </li>
                  
                </ol>
              </li>
              
              <li class="toc-item">
                <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#level-6">Level 6</a>
                <ol>
                  
                </ol>
              </li>
              
            </ol>
          </li>
          
          <li class="toc-item">
            <a href="https:&#x2F;&#x2F;www.cblanken.dev&#x2F;articles&#x2F;overthewireleviathan&#x2F;#conclusion">Conclusion</a>
            <ol>
              
            </ol>
          </li>
          
        </ol>
      </div>
    </div>
  </div>
   
<h1 id="title" class="post-title">
  <a href="https://www.cblanken.dev/articles/overthewireleviathan/">OverTheWire - Leviathan</a>
</h1>
 
<div class="post-meta-inline">
  <div>
    <div class="post-sub-title">Published</div>
    <div>
<span class="post-date"> Nov 24, 2024 </span>
</div>
  </div>
  

  <div>
    <div class="post-sub-title">Reading time</div>
    
    <div>11 minutes</div>
    
  </div>
</div>


<div>
<div class="post-tags">
  <a
    class="post-tag"
    href="https://www.cblanken.dev/tags/linux/"
    >#Linux</a
  >
  
  <a
    class="post-tag"
    href="https://www.cblanken.dev/tags/overthewire/"
    >#OverTheWire</a
  >
  
  <a
    class="post-tag"
    href="https://www.cblanken.dev/tags/ctf/"
    >#ctf</a
  >
  
  <a
    class="post-tag"
    href="https://www.cblanken.dev/tags/infosec/"
    >#infosec</a
  >
  
  <a
    class="post-tag"
    href="https://www.cblanken.dev/tags/wargame/"
    >#wargame</a
  >
  </div>
</div>
 <div class="post-content"><h2 id="introduction"><a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">Introduction</a></h2>
<p><a href="https://overthewire.org/wargames/leviathan/">Leviathan</a> is another
<a href="https://en.wikipedia.org/wiki/Wargame_(hacking)">wargame</a> available at
<a href="https://overthewire.org/">overthewire.org</a>.</p>
<p>In this walkthrough I'm going to show the process for solving each challenge
while also providing some insight into what each challenge is trying to teach
and why it's useful. Keep an eye out for callouts like those below.</p>
<svg 
  version="1.1" 
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  style="display: none;">
    <style>
        .info-text {
            font-size: 60px;
            font-weight: 600;
            font-family: 'Atkinson Hyperlegible', 'Tahoma', 'Arial';
        }
    </style>
    <symbol id="info" viewBox="0 0 100 100">
        <circle
           id="info-circle"
           stroke="currentColor"
           stroke-width="10"
           cx="50"
           cy="50"
           r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">i</text>
    </symbol>
    <symbol id="warn" viewBox="0 0 100 100">
        <circle
          id="warning-circle"
          stroke="currentColor"
          stroke-width="10"
          cx="50"
          cy="50"
          r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">!</text>
    </symbol>
    <symbol id="tip" viewBox="0 0 285 285">
        <polygon
          id="tip-star"
          stroke="#efefef"
          stroke-width="20"
          points="150,15 258,77 258,202 150,265 42,202 42,77"
          fill="currentColor"
        />
    </symbol>
</svg>


<div class="callout tip">
  <div class="callout-head">
    <svg class="icon"><use xlink:href="#tip"></use></svg>
    <div>Tip</div>
  </div>
  <div class="callout-text">
    <p>Access to each level is made over SSH. The username will correspond to the
index of the level starting at 0. Always make sure you're logging into the
correct level!</p>
<p>If you're new to CTFs and wargames you may want to check out the <a href="https://www.cblanken.dev/articles/overthewirebandit/">Bandit
wargame walkthrough</a> first.</p>

  </div>
</div>


<style>
</style>
<p>None of the Leviathan levels have any additional descriptions. Presumably,
since they're relatively simple, any hints would probably give away the
solution. Instead you're dropped into a regular user session after login with
the task of identifying any important files available to that user and using
them to find the password to the next level.</p>
<h2 id="walkthrough"><a class="zola-anchor" href="#walkthrough" aria-label="Anchor link for: walkthrough">Walkthrough</a></h2>
<h3 id="level-0"><a class="zola-anchor" href="#level-0" aria-label="Anchor link for: level-0">Level 0</a></h3>
<p>To start, there only appears to be a few hidden dotfiles in the home directory.
<img src="/images/otw-leviathan/0_ls.png" alt="level 0 ls" /></p>
<p>The only atypical thing here is the <code>~/.backup</code> directory which contains a
<code>bookmarks.html</code> file.</p>
<h4 id="solution"><a class="zola-anchor" href="#solution" aria-label="Anchor link for: solution">Solution</a></h4>
<p>It's certainly possible to manually read through the bookmarks for anything
interesting, but <code>grep</code> can be utilized to search for some keywords which might
be useful. For example, "password" or "flag".</p>
<p><img src="/images/otw-leviathan/0_flag.png" alt="level 0 flag" /></p>
<svg 
  version="1.1" 
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  style="display: none;">
    <style>
        .info-text {
            font-size: 60px;
            font-weight: 600;
            font-family: 'Atkinson Hyperlegible', 'Tahoma', 'Arial';
        }
    </style>
    <symbol id="info" viewBox="0 0 100 100">
        <circle
           id="info-circle"
           stroke="currentColor"
           stroke-width="10"
           cx="50"
           cy="50"
           r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">i</text>
    </symbol>
    <symbol id="warn" viewBox="0 0 100 100">
        <circle
          id="warning-circle"
          stroke="currentColor"
          stroke-width="10"
          cx="50"
          cy="50"
          r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">!</text>
    </symbol>
    <symbol id="tip" viewBox="0 0 285 285">
        <polygon
          id="tip-star"
          stroke="#efefef"
          stroke-width="20"
          points="150,15 258,77 258,202 150,265 42,202 42,77"
          fill="currentColor"
        />
    </symbol>
</svg>


<div class="callout tip">
  <div class="callout-head">
    <svg class="icon"><use xlink:href="#tip"></use></svg>
    <div>Tip</div>
  </div>
  <div class="callout-text">
    <p>This example is a bit contrived for the sake of the wargame, but this is a
common tactic used by attackers. Searching a user's files with <code>grep</code> for
things like usernames, passwords, bank or credit card details, and any other
kind of sensitive information is one of the first things an attacker might do
once they've compromised a user's account.</p>
<p>It should go without saying that you should never store any passwords or other
sensitive information in plain text files if it can be avoided. Ideally use a
password manager with secure encryption to store any digital account details.</p>

  </div>
</div>


<style>
</style>
<h3 id="level-1"><a class="zola-anchor" href="#level-1" aria-label="Anchor link for: level-1">Level 1</a></h3>
<p><img src="/images/otw-leviathan/1_ls.png" alt="level 1 ls" /></p>
<p>This level presents us with a <a href="https://en.wikipedia.org/wiki/Setuid">setuid</a>
binary. On some systems this is evident by the red background color, but to
verify, you just need to check the file permissions with <code>ls -l</code>. There will be
an <code>s</code> in place of the typical <code>x</code> for the user level execution permissions.</p>
<p><img src="/images/otw-leviathan/1_setuid.png" alt="level 1 setuid" /></p>
<p><img src="/images/otw-leviathan/1_run_check.png" alt="level 1 run check" /></p>
<p>After running it with an input of <code>abc</code>, it's clear from the output that the
input is being checked against some password string for correctness.</p>
<p>We can do some preliminary analysis of the binary's execution with the
<a href="https://www.man7.org/linux/man-pages/man1/ltrace.1.html"><code>ltrace</code></a> program
which will record the C level dynamic library function calls made by <code>check</code>.
This includes common standard library functions like
<a href="https://www.man7.org/linux/man-pages/man3/strcmp.3.html"><code>strcmp</code></a>.</p>
<h4 id="solution-1"><a class="zola-anchor" href="#solution-1" aria-label="Anchor link for: solution-1">Solution</a></h4>
<p><img src="/images/otw-leviathan/1_solve_check.png" alt="level 1 solve check" /></p>
<p>From the output of the above <code>ltrace</code>, we can see the parameters passed to the
<code>strcmp</code> function call. The first is our test password, and the second is the
target password that <code>check</code> is using to verify the input.</p>
<svg 
  version="1.1" 
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  style="display: none;">
    <style>
        .info-text {
            font-size: 60px;
            font-weight: 600;
            font-family: 'Atkinson Hyperlegible', 'Tahoma', 'Arial';
        }
    </style>
    <symbol id="info" viewBox="0 0 100 100">
        <circle
           id="info-circle"
           stroke="currentColor"
           stroke-width="10"
           cx="50"
           cy="50"
           r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">i</text>
    </symbol>
    <symbol id="warn" viewBox="0 0 100 100">
        <circle
          id="warning-circle"
          stroke="currentColor"
          stroke-width="10"
          cx="50"
          cy="50"
          r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">!</text>
    </symbol>
    <symbol id="tip" viewBox="0 0 285 285">
        <polygon
          id="tip-star"
          stroke="#efefef"
          stroke-width="20"
          points="150,15 258,77 258,202 150,265 42,202 42,77"
          fill="currentColor"
        />
    </symbol>
</svg>


<div class="callout tip">
  <div class="callout-head">
    <svg class="icon"><use xlink:href="#tip"></use></svg>
    <div>Tip</div>
  </div>
  <div class="callout-text">
    <p>The <code>ltrace</code> program can be quite useful to perform some initial analysis of a
binary's execution before transitioning to more advanced tools like the <code>gdb</code>
debugger.</p>

  </div>
</div>


<style>
</style>
<h3 id="level-2"><a class="zola-anchor" href="#level-2" aria-label="Anchor link for: level-2">Level 2</a></h3>
<p>Here's another <code>setuid</code> binary.</p>
<p><img src="/images/otw-leviathan/2_ls.png" alt="level 2 ls" /></p>
<p>Executing prints from usage information to the console.</p>
<p><img src="/images/otw-leviathan/2_run_printfile.png" alt="level 2 run printfile" /></p>
<p>Following the usage description, a file path may be passed as an argument and
be printed to the console.</p>
<p><img src="/images/otw-leviathan/2_try_print_password.png" alt="level 2 run printfile" /></p>
<p>Unfortunately, printing the <code>level3</code> password file isn't allowed.</p>
<p>To investigate, let's use the <code>ltrace</code> command again.</p>
<p><img src="/images/otw-leviathan/2_ltrace.png" alt="level 2 run printfile" /></p>
<p>The <code>ltrace</code> output shows calls to
<a href="https://man7.org/linux/man-pages/man3/access.3p.html"><code>access</code></a>,
<a href="https://www.man7.org/linux/man-pages/man3/snprintf.3p.html"><code>snprintf</code></a>, and
<a href="https://man7.org/linux/man-pages/man3/system.3.html"><code>system</code></a>.</p>
<p><img src="/images/otw-leviathan/2_try_print_bashrc.png" alt="level 2 run printfile" /></p>
<p>Attempting to read another file for which we have read permissions, e.g.
<code>.bashrc</code>, shows that <code>printfile</code> executes the shell command <code>/bin/cat &lt;FILEPATH&gt;</code>  when the <code>access</code> function call succeeds where <code>&lt;FILEPATH&gt;</code> is
whatever you pass as the first argument to <code>printfile</code>.</p>
<svg 
  version="1.1" 
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  style="display: none;">
    <style>
        .info-text {
            font-size: 60px;
            font-weight: 600;
            font-family: 'Atkinson Hyperlegible', 'Tahoma', 'Arial';
        }
    </style>
    <symbol id="info" viewBox="0 0 100 100">
        <circle
           id="info-circle"
           stroke="currentColor"
           stroke-width="10"
           cx="50"
           cy="50"
           r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">i</text>
    </symbol>
    <symbol id="warn" viewBox="0 0 100 100">
        <circle
          id="warning-circle"
          stroke="currentColor"
          stroke-width="10"
          cx="50"
          cy="50"
          r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">!</text>
    </symbol>
    <symbol id="tip" viewBox="0 0 285 285">
        <polygon
          id="tip-star"
          stroke="#efefef"
          stroke-width="20"
          points="150,15 258,77 258,202 150,265 42,202 42,77"
          fill="currentColor"
        />
    </symbol>
</svg>


<div class="callout note">
  <div class="callout-head">
    <svg class="icon"><use xlink:href="#info"></use></svg>
    <div>Note</div>
  </div>
  <div class="callout-text">
    <p>The above output was truncated since the <code>.bashrc</code> file is actually quite long.
In fact, you might want to redirect stdout to <code>/dev/null</code> to only display the
results from <code>ltrace</code>. Just to make it a bit more readable.</p>
<p><img src="/images/otw-leviathan/2_ltrace_dev_null.png" alt="level 2 ltrace /dev/null output" /></p>

  </div>
</div>


<style>
</style>
<h4 id="the-setuid-bit"><a class="zola-anchor" href="#the-setuid-bit" aria-label="Anchor link for: the-setuid-bit">The setuid bit</a></h4>
<p>We saw this in the previous level as well, but I wanted to call attention to
the fact that <code>printfile</code> has the <a href="https://en.wikipedia.org/wiki/Setuid"><code>setuid</code>
bit</a> set.</p>
<p>We can even see the function call to <code>setreuid</code> which will set the real and
effective user ID for the process. This level and the last are showcasing the
dangers of giving any file setuid permissions. Without it <code>printfile</code> wouldn't
be able to access the password file for level 3.</p>
<p>Our goal is to craft some input to <code>printfile</code> such that the <code>system</code> call will
execute for the password file (<code>/etc/leviathan_pass/leviathan3</code>). But, to reach
that point, the path passed in must also be readable by the <code>leviathan2</code> user.</p>
<p>With that in mind, one method we can use to trick <code>printfile</code> is by providing a
path with a variable. This way the variable will be expanded when the path is
passed to the <code>system</code> function, but will be interpreted literally by the call
to <code>access</code>.</p>
<svg 
  version="1.1" 
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  style="display: none;">
    <style>
        .info-text {
            font-size: 60px;
            font-weight: 600;
            font-family: 'Atkinson Hyperlegible', 'Tahoma', 'Arial';
        }
    </style>
    <symbol id="info" viewBox="0 0 100 100">
        <circle
           id="info-circle"
           stroke="currentColor"
           stroke-width="10"
           cx="50"
           cy="50"
           r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">i</text>
    </symbol>
    <symbol id="warn" viewBox="0 0 100 100">
        <circle
          id="warning-circle"
          stroke="currentColor"
          stroke-width="10"
          cx="50"
          cy="50"
          r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">!</text>
    </symbol>
    <symbol id="tip" viewBox="0 0 285 285">
        <polygon
          id="tip-star"
          stroke="#efefef"
          stroke-width="20"
          points="150,15 258,77 258,202 150,265 42,202 42,77"
          fill="currentColor"
        />
    </symbol>
</svg>


<div class="callout tip">
  <div class="callout-head">
    <svg class="icon"><use xlink:href="#tip"></use></svg>
    <div>Tip</div>
  </div>
  <div class="callout-text">
    <p>When attacking the input of a program, always try to identify different points
of entry. In this case there are two points at which the input path is passed
into the program. The first is to the call to <code>access</code> and the second to
<code>system</code>. Both of these functions process input differently. When you have
multiple points like this without some sort of input validation or
normalization, there's always an opportunity to disrupt the expected behavior
of the program.</p>
<p>On the flip-side of this, as a developer this showcases why input validation is
such an important concept. Never implicitly trust user input.</p>
<p>More specifically for this level, <code>system</code> should never be used in a setuid
program and user input should never be passed directly to a call to <code>system</code>
without sanitization. The <a href="https://www.man7.org/linux/man-pages/man3/system.3.html"><code>system</code> manual
page</a> explicitly warns
against this practice due to the potential for compromising system security.</p>
<p><img src="/images/otw-leviathan/2_system_manual_caveat.png" alt="system manual caveat" /></p>

  </div>
</div>


<style>
</style>
<h4 id="solution-2"><a class="zola-anchor" href="#solution-2" aria-label="Anchor link for: solution-2">Solution</a></h4>
<p><img src="/images/otw-leviathan/2_solution.png" alt="level 2 solution" /></p>
<h3 id="level-3"><a class="zola-anchor" href="#level-3" aria-label="Anchor link for: level-3">Level 3</a></h3>
<p>This challenge is almost identical to <a href="https://www.cblanken.dev/articles/overthewireleviathan/#level-1">level 1</a>, except that you are
dropped into a shell where you can easily <code>cat</code> the password file for level 4.</p>
<p>The intended solution for level 1 probably differs slightly from the one
provided here since having near duplicate solutions usually isn't done by
wargame and CTF authors.</p>
<p>Either way, this one is left as a challenge to the reader. Have fun!</p>
<h3 id="level-4"><a class="zola-anchor" href="#level-4" aria-label="Anchor link for: level-4">Level 4</a></h3>
<p>In this level, we have some more hidden files. In the <code>.trash</code> directory is
another setuid binary.</p>
<p><img src="/images/otw-leviathan/4_binary.png" alt="level 4 binary" /></p>
<p><img src="/images/otw-leviathan/4_ltrace.png" alt="level 4 ltrace" /></p>
<h4 id="solution-3"><a class="zola-anchor" href="#solution-3" aria-label="Anchor link for: solution-3">Solution</a></h4>
<p>All the leviathan challenges are possible without any programming, but in this
case, you could also solve it with a short python script.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#96b5b4;">print</span><span>(
</span><span>   &quot;&quot;.</span><span style="color:#bf616a;">join</span><span>(
</span><span>      [</span><span style="color:#96b5b4;">chr</span><span>(</span><span style="color:#bf616a;">int</span><span>(x, </span><span style="color:#d08770;">2</span><span>)) </span><span style="color:#b48ead;">for </span><span>x </span><span style="color:#b48ead;">in </span><span>&quot;</span><span style="color:#a3be8c;">00110000 01100100 01111001 01111000 01010100 00110111 01000110 00110100 01010001 01000100 00001010</span><span>&quot;.</span><span style="color:#bf616a;">split</span><span>()]
</span><span>   )
</span><span>)
</span></code></pre>
<p>This script splits the text into a list of binary numbers and converts each
binary number into decimal with <code>int(x, 2)</code>. Each integer is then translated
into the corresponding ASCII letter with the <code>chr</code> function before joining each
letter back into a single string.</p>
<p>Of course it's also possible to translate it by hand with an <a href="https://www.rapidtables.com/code/text/ascii-table.html">ASCII
table</a> though you'll
need to convert the binary numbers into either hexadecimal or decimal. Another
option is to use one of the many online translators, for example <a href="https://www.rapidtables.com/convert/number/binary-to-ascii.html">Binary to
Text
Translator</a>.</p>
<h3 id="level-5"><a class="zola-anchor" href="#level-5" aria-label="Anchor link for: level-5">Level 5</a></h3>
<p><img src="/images/otw-leviathan/5_first_run.png" alt="level 5 first run" /></p>
<p>It looks like the binary expects a file at <code>/tmp/file.log</code>. Let's make that
file with some dummy content and <code>ltrace</code> the binary to see what's going on.</p>
<p><img src="/images/otw-leviathan/5_ltrace_with_log_file.png" alt="level 5 first run" /></p>
<p>We have two important things going on in this binary.</p>
<ol>
<li>The contents of the <code>/tmp/file.log</code> are being printed.</li>
<li><code>/tmp/file.log</code> is deleted. See the <a href="https://www.man7.org/linux/man-pages/man2/unlink.2.html"><code>unlink</code> manual
page</a> for details.</li>
</ol>
<p>The deletion of the file is less of a concern since we can remake the file as
needed. More importantly, we have control of the file being printed.</p>
<h4 id="solution-4"><a class="zola-anchor" href="#solution-4" aria-label="Anchor link for: solution-4">Solution</a></h4>
<p>Obviously we don't care too much about the content of <code>/tmp/file.log</code>. But,
what if, we could link <code>/tmp/file.log</code> to a more interesting file. Like
<code>/etc/leviathan_pass/leviathan6</code> for example.</p>
<p><img src="/images/otw-leviathan/5_solution.png" alt="level 5 solution" /></p>
<p>Here we've simply made a symbolic link to <code>/etc/leviathan_pass/leviathan6</code> and
placed the link file at <code>/tmp/file.log</code>. When <code>leviathan5</code> is executed, the
link is followed to the password file for the next level which is printed to
stdout.</p>
<h3 id="level-6"><a class="zola-anchor" href="#level-6" aria-label="Anchor link for: level-6">Level 6</a></h3>
<p>Hopefully you've gotten the hang of the first few steps now.</p>
<ol>
<li>Check for interesting files in the home directory</li>
<li>Execute the binary and provide any required input</li>
<li>Run the binary via <code>ltrace</code> to see what function calls it's making</li>
</ol>
<p><img src="/images/otw-leviathan/6_first_run_ltrace.png" alt="level 6 binary identification and ltrace" /></p>
<p>Blast it, this time they've managed to foil our use of <code>ltrace</code>. There's
clearly some sort of check going on to verify the input code. We can probably
assume the check is happening in a simple <code>if</code> statement comparing the input
code to some hardcoded number. Which would explain why it doesn't show up in
<code>ltrace</code> since no library function call is being made.</p>
<p>At this point we're reaching beyond the capabilities of most basic Linux
commands. Instead you may have to reach for something like
<a href="https://www.man7.org/linux/man-pages/man1/gdb.1.html"><code>gdb</code></a>, the GNU
Debugger. The debugger will allow you to step through the program one
instruction at a time. Unfortunately it does require you understand a bit about
C and <a href="https://en.wikipedia.org/wiki/Assembly_language">Assembly language</a>.</p>
<p><img src="/images/otw-leviathan/6_gdb_asm1.png" alt="level 6 gdb assembly 1" /></p>
<p>In the disassembly of <code>leviathan6</code> above there are a few important lines.</p>
<ol>
<li>At line <code>main+76</code> we can see the function call to <code>atoi</code> which you should
recognize from the preliminary analysis with <code>ltrace</code>. Another important
concept to understand is that for x86 binaries like this one, the return
results of functions are usually assigned to the <code>eax</code> register.</li>
<li>A <code>cmp</code> instruction which is comparing the returned value of the <code>atoi</code>
function call in <code>eax</code> to another value on the stack at <code>[ebp-0xc]</code>.</li>
</ol>
<p>Use the <code>run</code> command to start the program. The program will begin executing
and stop at the first breakpoint it finds.</p>
<p>After the program stops, we can examine the arguments of the <code>cmp</code> instruction.
The command <code>info registers</code> will display the values for all the registers, or
the target register can be passed as an argument as shown below.</p>
<p>The format for the register listing is <code>register name | hexadecimal | decimal</code>.
You can see the decimal representation matches the PIN provided to the program
<code>1234</code>.</p>
<p>The other argument to <code>cmp</code> is a bit trickier. It's actually using a pointer.
Meaning the value at <code>ebp - 0xc</code> is actually a memory address and it must be
dereferenced to examine the value. The <code>x</code> command can be used to examine
memory like this. You can read more in the <a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/Memory.html">Examining Memory
section</a> of
the <a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/index.html">GDB
documentation</a>,
but, in summary, the command used here (<code>x/1d $ebp-0xc</code>) examines the memory at
the address computed by subtracting <code>0xc</code> from the value in the <code>ebp</code> register.
One integer value at the resolved memory address is then printed to the console
thanks to the display format of <code>1d</code>.</p>
<p><img src="/images/otw-leviathan/6_gdb_breakpoint_pin.png" alt="level 6 gdb breakpoint pin" /></p>
<h2 id="conclusion"><a class="zola-anchor" href="#conclusion" aria-label="Anchor link for: conclusion">Conclusion</a></h2>
<p>You can do quite a lot with just some basic terminal commands.</p>
<p>Supposedly all the Leviathan levels are possible without any programming
knowledge, so I suspect <a href="https://www.cblanken.dev/articles/overthewireleviathan/#level-6">level 6</a> has a simpler intended solution.</p>
<p>Either way, know your tools. I think <code>ltrace</code> in particular is useful for
understanding the actions of a binary without needing to resort to tools for
debugging and reverse engineering like gdb or Ghidra.</p>
<svg 
  version="1.1" 
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  style="display: none;">
    <style>
        .info-text {
            font-size: 60px;
            font-weight: 600;
            font-family: 'Atkinson Hyperlegible', 'Tahoma', 'Arial';
        }
    </style>
    <symbol id="info" viewBox="0 0 100 100">
        <circle
           id="info-circle"
           stroke="currentColor"
           stroke-width="10"
           cx="50"
           cy="50"
           r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">i</text>
    </symbol>
    <symbol id="warn" viewBox="0 0 100 100">
        <circle
          id="warning-circle"
          stroke="currentColor"
          stroke-width="10"
          cx="50"
          cy="50"
          r="45" />
        <text class="info-text" x="50" y="50" dy=".26rem" text-anchor="middle" dominant-baseline="middle" fill="currentColor">!</text>
    </symbol>
    <symbol id="tip" viewBox="0 0 285 285">
        <polygon
          id="tip-star"
          stroke="#efefef"
          stroke-width="20"
          points="150,15 258,77 258,202 150,265 42,202 42,77"
          fill="currentColor"
        />
    </symbol>
</svg>


<div class="callout warning">
  <div class="callout-head">
    <svg class="icon"><use xlink:href="#warn"></use></svg>
    <div>Warning</div>
  </div>
  <div class="callout-text">
    <p>Don't forget to clean up any files you've created.</p>
<p><code>rm -rf /tmp/MY_TEMP_DIRECTORY</code></p>

  </div>
</div>


<style>
</style>
</div>  
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read more</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    <span class="button previous">
      <span class="button__icon">«&nbsp;</span>
      <a href="https://www.cblanken.dev/articles/overthewirebandit/">
        <span class="button__text">OverTheWire - Bandit</span>
      </a>
    </span>
     
    <span class="button next">
      <a href="https://www.cblanken.dev/articles/overthewirenatas/">
        <span class="button__text">OverTheWire - Natas</span>
      </a>
      <span class="button__icon">&nbsp;»</span>
    </span>
    </div>
</div>

</div>


    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <div>© 
    2025
 Cameron Blankenbuehler</div>
                    <div class="copyright-theme">
                        <div>Theme: <a href="https://github.com/cblanken/zola-theme-terminimal/">Terminimal</a></div>
                    </div>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
